<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="As I was preparing an open source release of a tool, which was previously only developed internally I was looking into how to remove internal files (e.g. pipeline configurations) from the repository and additionally I wanted to clean up the commit history, as the commit authors contained internal information (e.g. usernames).
After a bit of searching the interwebs I stumbled over git filter-repo, which seems to be the solution of choice for this task nowadays."><meta name=color-scheme content="light dark"><meta itemprop=name content="Using git filter-repo to clean up Git history"><meta itemprop=description content="As I was preparing an open source release of a tool, which was previously only developed internally I was looking into how to remove internal files (e.g. pipeline configurations) from the repository and additionally I wanted to clean up the commit history, as the commit authors contained internal information (e.g. usernames).
After a bit of searching the interwebs I stumbled over git filter-repo, which seems to be the solution of choice for this task nowadays."><meta itemprop=datePublished content="2024-01-22T10:34:29+01:00"><meta itemprop=dateModified content="2024-01-22T10:34:29+01:00"><meta itemprop=wordCount content="344"><meta itemprop=keywords content="Git,How-To"><meta property="og:url" content="https://blog.perfectlynormalgeek.com/posts/git-filter-repo/"><meta property="og:site_name" content="Ramblings of a perfectly normal geek"><meta property="og:title" content="Using git filter-repo to clean up Git history"><meta property="og:description" content="As I was preparing an open source release of a tool, which was previously only developed internally I was looking into how to remove internal files (e.g. pipeline configurations) from the repository and additionally I wanted to clean up the commit history, as the commit authors contained internal information (e.g. usernames).
After a bit of searching the interwebs I stumbled over git filter-repo, which seems to be the solution of choice for this task nowadays."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-22T10:34:29+01:00"><meta property="article:modified_time" content="2024-01-22T10:34:29+01:00"><meta property="article:tag" content="Git"><meta property="article:tag" content="How-To"><meta name=generator content="Hugo 0.127.0"><title>Using git filter-repo to clean up Git history | Ramblings of a perfectly normal geek</title>
<link rel=canonical href=https://blog.perfectlynormalgeek.com/posts/git-filter-repo/><link rel=stylesheet href=/css/base.min.6f90c1c7b364204e7446130eaccbb5b77a435b45eb3f07387c7611e3a120c139.min.6f90c1c7b364204e7446130eaccbb5b77a435b45eb3f07387c7611e3a120c139.css integrity="sha256-b5DBx7NkIE50RhMOrMu1t3pDW0XrPwc4fHYR46EgwTk=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.065df42d2be658bb8e0720297aadf469355a5ffaf863b00e3cce0627dd106ca0.css integrity="sha256-Bl30LSvmWLuOByApeq30aTVaX/r4Y7AOPM4GJ90QbKA=" crossorigin=anonymous></head><body><nav class=u-background><div class=u-wrapper><ul class=Banner><li class="Banner-item Banner-item--title"><a class="Banner-link u-clickable" href=/>Ramblings of a perfectly normal geek</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/>About</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/>Posts</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/tags/>Tags</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/categories/>Categories</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/index.xml>RSS</a></li></ul></div></nav><main><div class=u-wrapper><div class=u-padding><header class=Heading><h1 class=Heading-title><a class="Heading-link u-clickable" href=/posts/git-filter-repo/ rel=bookmark>Using git filter-repo to clean up Git history</a></h1><time datetime=2024-01-22T10:34:29+01:00>January 22, 2024</time></header><p>As I was preparing an open source release of a tool, which was previously only developed internally I was looking into how to remove internal files (e.g. pipeline configurations) from the repository and additionally I wanted to clean up the commit history, as the commit authors contained internal information (e.g. usernames).</p><p>After a bit of searching the interwebs I stumbled over <a href=https://github.com/newren/git-filter-repo><code>git filter-repo</code></a>, which seems to be the solution of choice for this task nowadays.</p><h2 id=git-filter-repo-usage><a class="Heading-link u-clickable" href=/posts/git-filter-repo/#git-filter-repo-usage>git filter-repo usage</a></h2><p>First thing you need to be aware of is that by default <code>git filter-repo</code> refuses to work on repositories which haven&rsquo;t been freshly pulled.
This is is a security mechanism, which is meant to protect you from shooting yourself in the foot.
So the first step of the process is creating a fresh clone of your repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://example.com/repo.git</span></span></code></pre></div><h3 id=removing-files-from-git-history><a class="Heading-link u-clickable" href=/posts/git-filter-repo/#removing-files-from-git-history>Removing files from Git history</a></h3><p>Compared to the complex combination of commands, which would be required to achieve the same result with <code>git filter-branch</code>, this is a stupid simple task to achieve with <code>git filter-repo</code>.
Here&rsquo;s an example how to remove a <code>Jenkinsfile</code> from the repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git filter-repo --invert-paths --path Jenkinsfile</span></span></code></pre></div><p>The command also works the same if you want to remove whole repositories!</p><h3 id=cleaning-up-commit-authors><a class="Heading-link u-clickable" href=/posts/git-filter-repo/#cleaning-up-commit-authors>Cleaning up commit authors</a></h3><p>Because of the way the Git client was set up for the developers and some contributions being done directly in Bitbucket, some commits contained the username as the e-mail address of the commit id.
At first I thought I would have to write a script to loop over all commits and fix each authors, but luckily <code>git filter-repo</code> had my back again!
All I had to do was create a <code>.mailmap</code> file, which contained the information how to map commit author e-mail adresses to commit author names and run <code>git filter-repo --use-mailmap</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Will add John Doe as the commiter name for all commits made with the e-mail john.doe2@example.com</span>
</span></span><span style=display:flex><span>John Doe &lt;john.doe2@example.com&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># Will add John Doe as the commiter name and john.doe2@example.com as the commit e-mail for all commits with the e-mail u123456@example.com</span>
</span></span><span style=display:flex><span>John Doe &lt;john.doe2@example.com&gt; &lt;u123456@example.com&gt;</span></span></code></pre></div><footer><ul class=Tags><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=/tags/git/ rel=tag>Git</a></li><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=/tags/how-to/ rel=tag>How-To</a></li></ul></footer></div></div></main><footer class=Footer><div class=u-wrapper><div class="u-padding u-noboosting">Except where otherwise noted, content on this site is licensed under a   <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=license>Creative Commons Attribution-ShareAlike 4.0 International License</a>.</div></div></footer></body></html>