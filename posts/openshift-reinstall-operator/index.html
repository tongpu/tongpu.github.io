<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I recently ran into a problem where the install plan of an operator failed and I had to figure out how to reinstall an operator. It was definitely not as easy as I thought, so I decided to document how I managed to do it successfully.
Preparations Before proceeding you must create a backup of the operator subscription in your target namespace, otherwise you might have a hard time being able to install the operator again."><meta name=color-scheme content="light dark"><meta itemprop=name content="How to reinstall an operator on OpenShift"><meta itemprop=description content="I recently ran into a problem where the install plan of an operator failed and I had to figure out how to reinstall an operator. It was definitely not as easy as I thought, so I decided to document how I managed to do it successfully.
Preparations Before proceeding you must create a backup of the operator subscription in your target namespace, otherwise you might have a hard time being able to install the operator again."><meta itemprop=datePublished content="2024-06-24T09:17:06+02:00"><meta itemprop=dateModified content="2024-06-24T09:17:06+02:00"><meta itemprop=wordCount content="488"><meta itemprop=keywords content="Openshift,Olm,How-To"><meta property="og:url" content="https://blog.perfectlynormalgeek.com/posts/openshift-reinstall-operator/"><meta property="og:site_name" content="Ramblings of a perfectly normal geek"><meta property="og:title" content="How to reinstall an operator on OpenShift"><meta property="og:description" content="I recently ran into a problem where the install plan of an operator failed and I had to figure out how to reinstall an operator. It was definitely not as easy as I thought, so I decided to document how I managed to do it successfully.
Preparations Before proceeding you must create a backup of the operator subscription in your target namespace, otherwise you might have a hard time being able to install the operator again."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-24T09:17:06+02:00"><meta property="article:modified_time" content="2024-06-24T09:17:06+02:00"><meta property="article:tag" content="Openshift"><meta property="article:tag" content="Olm"><meta property="article:tag" content="How-To"><meta name=generator content="Hugo 0.127.0"><title>How to reinstall an operator on OpenShift | Ramblings of a perfectly normal geek</title>
<link rel=canonical href=https://blog.perfectlynormalgeek.com/posts/openshift-reinstall-operator/><link rel=stylesheet href=/css/base.min.6f90c1c7b364204e7446130eaccbb5b77a435b45eb3f07387c7611e3a120c139.min.6f90c1c7b364204e7446130eaccbb5b77a435b45eb3f07387c7611e3a120c139.css integrity="sha256-b5DBx7NkIE50RhMOrMu1t3pDW0XrPwc4fHYR46EgwTk=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.065df42d2be658bb8e0720297aadf469355a5ffaf863b00e3cce0627dd106ca0.css integrity="sha256-Bl30LSvmWLuOByApeq30aTVaX/r4Y7AOPM4GJ90QbKA=" crossorigin=anonymous></head><body><nav class=u-background><div class=u-wrapper><ul class=Banner><li class="Banner-item Banner-item--title"><a class="Banner-link u-clickable" href=/>Ramblings of a perfectly normal geek</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/>About</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/>Posts</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/tags/>Tags</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/categories/>Categories</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=/index.xml>RSS</a></li></ul></div></nav><main><div class=u-wrapper><div class=u-padding><header class=Heading><h1 class=Heading-title><a class="Heading-link u-clickable" href=/posts/openshift-reinstall-operator/ rel=bookmark>How to reinstall an operator on OpenShift</a></h1><time datetime=2024-06-24T09:17:06+02:00>June 24, 2024</time></header><p>I recently ran into a problem where the install plan of an operator failed and I had to figure out how to reinstall an operator.
It was definitely not as easy as I thought, so I decided to document how I managed to do it successfully.</p><h2 id=preparations><a class="Heading-link u-clickable" href=/posts/openshift-reinstall-operator/#preparations>Preparations</a></h2><p>Before proceeding you must create a backup of the operator subscription in your target namespace, otherwise you might have a hard time being able to install the operator again.
Additionally I would propose to also create a backup of the ClusterServiceVersion, which you tried to deploy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc get subscription -n example my-operator-o yaml &gt; subscription.yaml
</span></span><span style=display:flex><span>oc get clusterserviceversion -n exmaple my-operator.v2.3.3 -o yaml &gt; clusterserviceversion.yaml</span></span></code></pre></div><h2 id=recreating-the-subscription><a class="Heading-link u-clickable" href=/posts/openshift-reinstall-operator/#recreating-the-subscription>Recreating the subscription</a></h2><p>Before your able to recreate the subscription you should clean up the <code>subscription.yaml</code> file by deleting the <code>status</code> field.
Now you can proceed to recreate the subscription by deleting the subscription, as well as the ClusterServiceVersion object and any install plans present.</p><p>!!! WARNING !!! This should usually not result in the removal of the operator and should not result in data loss, but I can&rsquo;t guarantee this for every operator. You have been warned! !!! WARNING !!!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc delete subscription -n example my-operator
</span></span><span style=display:flex><span>oc delete clusterserviceversion -n example my-operator.v2.3.3
</span></span><span style=display:flex><span>oc delete installplan -n example --all</span></span></code></pre></div><p>Now we can proceed with recreating the subscription.
If you previously had a specific version version of the operator installed your subscription backup will contain <code>spec.installPlanApproval: Manual</code> and <code>spec.startingCSV: my-operator.v2.3.3</code> and you might have to update the version for <code>spec.startingCSV</code> to the one you&rsquo;re trying to install.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc apply -f subscription.yaml</span></span></code></pre></div><p>From now on there are two possible paths, depending on your configuration for <code>installPlanApproval</code>.</p><h3 id=automatic-install-plan-approval><a class="Heading-link u-clickable" href=/posts/openshift-reinstall-operator/#automatic-install-plan-approval>Automatic install plan approval</a></h3><p>After recreating the subscription it should be picked up by the olm-operator pod in the openshift-operator-lifecycle-manager namespace and a new ClusterServiceVersion object should be created and your operator should be updated to the most current version.
If this is not the case have a look at <a href=/posts/openshift-reinstall-operator/#recreating_catalog_job>recreating the catalog job</a>.</p><h3 id=manual-install-plan-approval><a class="Heading-link u-clickable" href=/posts/openshift-reinstall-operator/#manual-install-plan-approval>Manual install plan approval</a></h3><p>You should now see a new installplan in your operator namespace:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc get installplan -n example</span></span></code></pre></div><p>open the installplan and configure <code>spec.approved: true</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc edit installplan install-abcde</span></span></code></pre></div><p>after that the ClusterServiceVersion you request should be created and your operator should be installed to the version you requested.
If this is not the case have a look at <a href=/posts/openshift-reinstall-operator/#recreating_catalog_job>recreating the catalog job</a>.</p><h3 id=recreating-catalog-job><a class="Heading-link u-clickable" href=/posts/openshift-reinstall-operator/#recreating-catalog-job>Recreating catalog job</a></h3><p>One issue I ran into during the last time I had to perform the above tasks was that for some reason the installplan and ClusterServiceVersion were not created.
After a while debugging I found the error message &ldquo;already existing job abcdef&mldr;&rdquo; in the output of the catalog-operator pod in the openshift-operator-lifecycle-manager, immeditally after I created the subscription.
So all I&rsquo;ve had to do was delete the job with the ID mentioned in the error message and recreate the subscription again to resolve this issue:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>oc delete job -n openshift-operator-lifecycle-manager abcedf...</span></span></code></pre></div><footer><ul class=Tags><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=/tags/openshift/ rel=tag>Openshift</a></li><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=/tags/olm/ rel=tag>Olm</a></li><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=/tags/how-to/ rel=tag>How-To</a></li></ul></footer></div></div></main><footer class=Footer><div class=u-wrapper><div class="u-padding u-noboosting">Except where otherwise noted, content on this site is licensed under a   <a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=license>Creative Commons Attribution-ShareAlike 4.0 International License</a>.</div></div></footer></body></html>